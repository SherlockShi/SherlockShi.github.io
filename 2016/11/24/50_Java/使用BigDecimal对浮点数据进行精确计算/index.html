<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <link rel="canonical" href="http://sherlockshi.github.io//2016/11/24/50_Java/使用BigDecimal对浮点数据进行精确计算/">
  
  
  <title>使用BigDecimal对浮点数据进行精确计算【转】 | SherlockShi&#39;s Home | Don&#39;t be evil.</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  
  <meta name="theme-color" content="#3F51B5">
  
  
  <meta name="keywords" content="java,浮点,float,double,精确计算">
  <meta name="description" content="本文转载自Java中浮点型数据Float和Double进行精确计算的问题

一、浮点计算中发生精度丢失大概很多有编程经验的朋友都对这个问题不陌生了：无论你使用的是什么编程语言，在使用浮点型数据进行精确计算时，你都有可能遇到计算结果出错的情况。来看下面的例子。

这是一个利用浮点型数据进行精确计算时结果出错的例子，使用Java编写，有所省略。

12double a = (1.2 - 0.4) /">
<meta property="og:type" content="article">
<meta property="og:title" content="使用BigDecimal对浮点数据进行精确计算【转】">
<meta property="og:url" content="http://sherlockshi.github.io/2016/11/24/50_Java/使用BigDecimal对浮点数据进行精确计算/index.html">
<meta property="og:site_name" content="SherlockShi's Home">
<meta property="og:description" content="本文转载自Java中浮点型数据Float和Double进行精确计算的问题

一、浮点计算中发生精度丢失大概很多有编程经验的朋友都对这个问题不陌生了：无论你使用的是什么编程语言，在使用浮点型数据进行精确计算时，你都有可能遇到计算结果出错的情况。来看下面的例子。

这是一个利用浮点型数据进行精确计算时结果出错的例子，使用Java编写，有所省略。

12double a = (1.2 - 0.4) /">
<meta property="og:updated_time" content="2016-11-24T08:47:03.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="使用BigDecimal对浮点数据进行精确计算【转】">
<meta name="twitter:description" content="本文转载自Java中浮点型数据Float和Double进行精确计算的问题

一、浮点计算中发生精度丢失大概很多有编程经验的朋友都对这个问题不陌生了：无论你使用的是什么编程语言，在使用浮点型数据进行精确计算时，你都有可能遇到计算结果出错的情况。来看下面的例子。

这是一个利用浮点型数据进行精确计算时结果出错的例子，使用Java编写，有所省略。

12double a = (1.2 - 0.4) /">
  
    <link rel="alternative" href="/atom.xml" title="SherlockShi&#39;s Home" type="application/atom+xml">
  
  <meta name="summary" content="null">
  <link rel="shortcut icon" href="http://7xlpfl.com1.z0.glb.clouddn.com/16-10-1/61240869.jpg">
  <link rel="stylesheet" href="/css/style.css?v=undefined">
</head>

<body>
  <div id="loading" class="active"></div>

  <aside id="menu" class="hide" >
  <div class="inner flex-row-vertical">
    <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menu-off">
        <i class="icon icon-lg icon-close"></i>
    </a>
    <div class="brand-wrap">
      <div class="brand">
        <a href="/" class="avatar"><img src="http://7xlpfl.com1.z0.glb.clouddn.com/16-10-1/61240869.jpg"></a>
        <hgroup class="introduce">
          <h5 class="nickname">SherlockShi</h5>
          <a href="mailto:sherlock_shi@163.com" title="sherlock_shi@163.com" class="mail">sherlock_shi@163.com</a>
        </hgroup>
      </div>
    </div>
    <div class="scroll-wrap flex-col">
      <ul class="nav">
        
            <li class="waves-block waves-effect">
              <a href="/"  >
                <i class="icon icon-lg icon-home"></i>
                Home
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/archives"  >
                <i class="icon icon-lg icon-archives"></i>
                Archives
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/tags"  >
                <i class="icon icon-lg icon-tags"></i>
                Tags
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="https://github.com/sherlockshi" target="_blank" >
                <i class="icon icon-lg icon-github"></i>
                Github
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="http://weibo.com/2283093752" target="_blank" >
                <i class="icon icon-lg icon-weibo"></i>
                Weibo
              </a>
            </li>
        
      </ul>

      <footer class="footer">
  <p><a rel="license" target="_blank" href="http://creativecommons.org/licenses/by-nc-sa/4.0/"><img alt="Creative Commons License" style="border-width:0;vertical-align:middle;" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAFAAAAAPCAMAAABEF7i9AAAAllBMVEUAAAD///+rsapERER3d3eIiIjMzMzu7u4iIiKUmZO6v7rKzsoODg4RERFVVVUNDQ0NDg0PEA8zMzNLTEtbXltmZmZydnF9gn2AgICPkI+ZmZmqqqq7u7vFxsXIzMgNDQwZGRkgICAhISEkJSMnKCcuMC4xMzE5Ozk7PTtBQkFCQkJDQ0Nna2eGhoaHh4ezuLLGysbd3d1wVGpAAAAA4UlEQVR42q2T1xqCMAyFk7QsBQeKA9x7j/d/OSm22CpX0nzcpA1/T05aAOuBVkMAScQFHLnEwoCo2f1TnQIGoVMewjZEjVFN4GH1Ue1Cn2jWqwfsOOj6wDwGvotsl/c8lv7KIq1eLOsT0HMFHMIE/RZyHnlphryT9zyV+8WH5e8yQw3wnQvgAFxPTKUVi555SHR/lOfLMgVTeDlSfN+TaoUsiTyeIm+bCkHvCA2FUKG48LDtYBZBknsYP/G8NTw0gaaHyuQf4H5pecrB/FYCT2sL9zAfy1Xyjou6L8X2W7YcLyBZCRtnq/zfAAAAAElFTkSuQmCC" /></a></p>
  <p>SherlockShi&#39;s Home &copy; 2016</p>
  <p>Power by <a href="http://hexo.io/" target="_blank">Hexo</a> Theme
  <a href="https://github.com/yscoder/hexo-theme-indigo" target="_blank">indigo</a></p>
  <a href="/atom.xml" target="_blank" class="rss" title="rss"><i class="icon icon-2x icon-rss-square"></i></a>
</footer>

    </div>
  </div>
</aside>
  <main id="main">
    <header class="top-header" id="header">
    <div class="flex-row">
        <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light on" id="menu-toggle">
          <i class="icon icon-lg icon-navicon"></i>
        </a>
        <div class="flex-col header-title ellipsis">使用BigDecimal对浮点数据进行精确计算【转】</div>
        
        <div class="search-wrap" id="search-wrap">
            <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="back">
                <i class="icon icon-lg icon-chevron-left"></i>
            </a>
            <input type="text" id="key" class="search-input" autocomplete="off" placeholder="输入感兴趣的关键字">
            <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="search">
                <i class="icon icon-lg icon-search"></i>
            </a>
        </div>
        
        
        <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menu-share">
            <i class="icon icon-lg icon-share-alt"></i>
        </a>
        
    </div>
</header>
<header class="content-header post-header">

    <div class="container">
        <h1 class="title">使用BigDecimal对浮点数据进行精确计算【转】</h1>
        
        

    </div>

    

</header>


<div class="container body-wrap">
    
    <aside class="post-widget">
        <nav class="post-toc-wrap" id="post-toc">
            <h4>TOC</h4>
            <ol class="post-toc"><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#一、浮点计算中发生精度丢失"><span class="post-toc-text">一、浮点计算中发生精度丢失</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#二、为何会出现精度丢失"><span class="post-toc-text">二、为何会出现精度丢失</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#三、如何使用浮点数进行精确计算"><span class="post-toc-text">三、如何使用浮点数进行精确计算</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#附录：Arith源代码"><span class="post-toc-text">附录：Arith源代码</span></a></li></ol>
        </nav>
    </aside>
    
<article id="post-50_Java/使用BigDecimal对浮点数据进行精确计算" 
  class="post-article article-type-post" itemprop="blogPost">

    <div class="post-card">
        <h1 class="post-card-title">使用BigDecimal对浮点数据进行精确计算【转】</h1>
        <div class="post-meta">
            <time datetime="2016-11-24T08:23:00.000Z" itemprop="datePublished" class="post-time">
  2016-11-24
</time>

            


        </div>
        <div class="post-content" id="post-content" itemprop="postContent">
            <blockquote>
<p>本文转载自<a href="https://my.oschina.net/junn/blog/136978" target="_blank" rel="external">Java中浮点型数据Float和Double进行精确计算的问题</a></p>
</blockquote>
<h1 id="一、浮点计算中发生精度丢失"><a href="#一、浮点计算中发生精度丢失" class="headerlink" title="一、浮点计算中发生精度丢失"></a>一、浮点计算中发生精度丢失</h1><p>大概很多有编程经验的朋友都对这个问题不陌生了：无论你使用的是什么编程语言，在使用浮点型数据进行精确计算时，你都有可能遇到计算结果出错的情况。来看下面的例子。</p>
<blockquote>
<p>这是一个利用浮点型数据进行精确计算时结果出错的例子，使用Java编写，有所省略。</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">double</span> a = (<span class="number">1.2</span> - <span class="number">0.4</span>) / <span class="number">0.1</span>;</span><br><span class="line">System.out.println(a);</span><br></pre></td></tr></table></figure>
<p>如果你认为这个程序的输出结果是“<code>8</code>”的话，那你就错了。实际上，程序的输出结果是“<code>7.999999999999999</code>”。好，问题来了。到底是哪里出了错？</p>
<p>浮点型数据进行精确计算时，该类问题并不少见。我们姑且称其为“精度丢失”吧。大家可以试着改一下上面的程序，你会发现一些有趣的现象：</p>
<ol>
<li><p>如果你直接使用一个数字代替括号里的表达式，如“<code>0.8 / 0.1</code>”或者“<code>1.1 /0.1</code>”，那么似乎，注意只是似乎不会出现问题；</p>
</li>
<li><p>我们可能会做第二个测试，就是对比“<code>0.8 / 1.1</code>”和“<code>(1.2 - 0.4) / 1.1</code>”的结果，没错，我就是这样做的。那么你会发现，前者的结果是“<code>0.7272727272727273</code>”（四舍五入后的结果），而后者的结果是 “<code>0.7272727272727272</code>”（没有进行四舍五入）。可以推测，经过一次计算后，精度丢失了；</p>
</li>
<li><p>很好，我觉得我们已经很接近真相了，但是接下来的第三个测试或许会让你泄气，我是这样做的：对比“<code>(2.4 - 0.1) / 0.1</code>”、“<code>(1.2 - 0.1) / 0.1</code>”以及“<code>(1.1 - 0.1) / 0.1</code>”的结果，第一个是“<code>22.999999999999996</code>”，第二个是“<code>10.999999999999998</code>”，第三个是“<code>10.0</code>”。似乎完 全推翻了我们的想法；</p>
</li>
<li><p>你可能还不死心，因为在上面的测试里，第三个表达式括号中的结果实在太诡异了，正好是“<code>1.0</code>”。那我们再来对比一下“<code>(2.4 - 0.2) / 0.1</code>”和“<code>(2.4 - 0.3) / 0.1</code>”，前者结果是“<code>21.999999999999996</code>”，后者结果是“<code>21.0</code>”。恭喜你，做到这里，你终于可以放弃这个无聊的测试了。</p>
</li>
<li><p>最后，我们还可以来推翻一下我们第一个测试的假设：当使用“<code>2.3 / 0.1</code>”时，结果为“<code>22.999999999999996</code>”，出现精度丢失。也就是说，所谓“经过一次计算后，精度丢失”的假设是不成立的。</p>
</li>
</ol>
<h1 id="二、为何会出现精度丢失"><a href="#二、为何会出现精度丢失" class="headerlink" title="二、为何会出现精度丢失"></a>二、为何会出现精度丢失</h1><p>那么为什么会出现精度丢失呢？在查阅了一些资料以后，我稍微有了一些头绪，下面是本人的愚见，仅供参考。</p>
<p>首先得从计算机本身去讨论这个问题。我们知道，计算机并不能识别除了二进制数据以外的任何数据。无论我们使用何种编程语言，在何种编译环境下工作，都要先 把源程序翻译成二进制的机器码后才能被计算机识别。以上面提到的情况为例，我们源程序里的<code>2.4</code>是十进制的，计算机不能直接识别，要先编译成二进制。但问 题来了，<code>2.4</code>的二进制表示并非是精确的<code>2.4</code>，反而最为接近的二进制表示是<code>2.3999999999999999</code>。原因在于浮点数由两部分组成：指数和 尾数，这点如果知道怎样进行浮点数的二进制与十进制转换，应该是不难理解的。如果在这个转换的过程中，浮点数参与了计算，那么转换的过程就会变得不可预 知，并且变得不可逆。我们有理由相信，就是在这个过程中，发生了精度的丢失。而至于为什么有些浮点计算会得到准确的结果，应该也是碰巧那个计算的二进制与 十进制之间能够准确转换。而当输出单个浮点型数据的时候，可以正确输出，如</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">double</span> d = <span class="number">2.4</span>;</span><br><span class="line">System.out.println(d);</span><br></pre></td></tr></table></figure>
<p>输出的是<code>2.4</code>，而不是<code>2.3999999999999999</code>。也就是说，不进行浮点计算的时候，在十进制里浮点数能正确显示。这更印证了我以上的想法，即如果浮点数参与了计算，那么浮点数二进制与十进制间的转换过程就会变得不可预知，并且变得不可逆。</p>
<p>事实上，浮点数并不适合用于精确计算，而适合进行科学计算。这里有一个小知识：既然<code>float</code>和<code>double</code>型用来表示带有小数点的数，那为什么我们不称 它们为“小数”或者“实数”，要叫浮点数呢？因为这些数都以科学计数法的形式存储。当一个数如<code>50.534</code>，转换成科学计数法的形式为<code>5.053e1</code>，它 的小数点移动到了一个新的位置（即浮动了）。可见，浮点数本来就是用于科学计算的，用来进行精确计算实在太不合适了。</p>
<h1 id="三、如何使用浮点数进行精确计算"><a href="#三、如何使用浮点数进行精确计算" class="headerlink" title="三、如何使用浮点数进行精确计算"></a>三、如何使用浮点数进行精确计算</h1><p>那么能够使用浮点数进行精确计算吗？直接计算当然是不行啦，但是我们当然也可以通过一些方法和技巧来解决这个问题。由于浮点数计算的结果跟正确结果非常接近，你很可能想到使用四舍五入来处理结果，以得到正确的答案。这是个不错的思路。</p>
<p>那么如何实现四舍五入呢？你可能会想到<code>Math</code>类中的<code>round</code>方法，但是有个问题，<code>round</code>方法不能设置保留几位小数，如果我们要保留两位小数，我们只能像这样实现：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">double</span> <span class="title">round</span><span class="params">(<span class="keyword">double</span> value)</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> Math.round(value*<span class="number">100</span>)/<span class="number">100.0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>如果这能得到正确的结果也就算了，大不了我们再想方法改进。但是非常不幸，上面的代码并不能正常工作，如果给这个方法传入<code>4.015</code>，它将返回<code>4.01</code>而不是<code>4.02</code>。</p>
<p><code>java.text.DecimalFormat</code>也不能解决这个问题，来看下面的例子：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">System.out.println(<span class="keyword">new</span> java.text.DecimalFormat(<span class="string">"0.00"</span>).format(<span class="number">4.025</span>));</span><br></pre></td></tr></table></figure>
<p>它的输出是<code>4.02</code>，而非<code>4.03</code>。</p>
<p>难道没有解决方法了吗？当然有的。在<code>《Effective Java》</code>这本书中就给出了一个解决方法。该书中也指出，float和double只能用来做科学计算或者是工程计算，在商业计算等精确计算中，我们要用<code>java.math.BigDecimal</code>。</p>
<p><code>BigDecimal</code>类一个有4个方法，我们只关心对我们解决浮点型数据进行精确计算有用的方法，即</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">BigDecimal(<span class="keyword">double</span> value) <span class="comment">// 将double型数据转换成BigDecimal型数据</span></span><br></pre></td></tr></table></figure>
<p>思路很简单，我们先通过<code>BigDecimal(double value)</code>方法，将<code>double</code>型数据转换成<code>BigDecimal</code>数据，然后就可以正常进行精确计算了。等计算完毕后，我们可以对结果做一些处理，比如 对除不尽的结果可以进行四舍五入。最后，再把结果由<code>BigDecimal</code>型数据转换回<code>double</code>型数据。</p>
<p>这个思路很正确，但是如果你仔细看看API里关于<code>BigDecimal</code>的详细说明，你就会知道，如果需要精确计算，我们不能直接用<code>double</code>，而非要用 <code>String</code>来构造<code>BigDecimal</code>不可！所以，我们又开始关心<code>BigDecimal</code>类的另一个方法，即能够帮助我们正确完成精确计算的 <code>BigDecimal(String value)</code>方法。</p>
<blockquote>
<p>BigDecimal(String value)能够将String型数据转换成BigDecimal型数据</p>
</blockquote>
<p>那么问题来了，想像一下吧，如果我们要做一个浮点型数据的加法运算，需要先将两个浮点数转为<code>String</code>型数据，然后用 <code>BigDecimal(String value)</code>构造成<code>BigDecimal</code>，之后要在其中一个上调用<code>add</code>方法，传入另一个作为参数，然后把运算的结果<code>（BigDecimal）</code>再转换为浮 点数。如果每次做浮点型数据的计算都要如此，你能够忍受这么烦琐的过程吗？至少我不能。所以最好的办法，就是写一个类，在类中完成这些繁琐的转换过程。这 样，在我们需要进行浮点型数据计算的时候，只要调用这个类就可以了。网上已经有高手为我们提供了一个工具类<code>Arith</code>来完成这些转换操作。它提供以下静态 方法，可以完成浮点型数据的加减乘除运算和对其结果进行四舍五入的操作：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">double</span> <span class="title">add</span><span class="params">(<span class="keyword">double</span> v1,<span class="keyword">double</span> v2)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">double</span> <span class="title">sub</span><span class="params">(<span class="keyword">double</span> v1,<span class="keyword">double</span> v2)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">double</span> <span class="title">mul</span><span class="params">(<span class="keyword">double</span> v1,<span class="keyword">double</span> v2)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">double</span> <span class="title">div</span><span class="params">(<span class="keyword">double</span> v1,<span class="keyword">double</span> v2)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">double</span> <span class="title">div</span><span class="params">(<span class="keyword">double</span> v1,<span class="keyword">double</span> v2,<span class="keyword">int</span> scale)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">double</span> <span class="title">round</span><span class="params">(<span class="keyword">double</span> v,<span class="keyword">int</span> scale)</span></span></span><br></pre></td></tr></table></figure>
<p>下面会附上Arith的源代码，大家只要把它编译保存好，要进行浮点数计算的时候，在你的源程序中导入Arith类就可以使用以上静态方法来进行浮点数的精确计算了。</p>
<h1 id="附录：Arith源代码"><a href="#附录：Arith源代码" class="headerlink" title="附录：Arith源代码"></a>附录：Arith源代码</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.math.BigDecimal;</span><br><span class="line"></span><br><span class="line">/`</span><br><span class="line">* 由于Java的简单类型不能够精确的对浮点数进行运算，这个工具类提供精</span><br><span class="line">* 确的浮点数运算，包括加减乘除和四舍五入。</span><br><span class="line">*/</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Arith</span> </span>&#123;</span><br><span class="line">    <span class="comment">//默认除法运算精度</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> DEF_DIV_SCALE = <span class="number">10</span>;</span><br><span class="line">    <span class="comment">//这个类不能实例化</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">Arith</span><span class="params">()</span></span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /`</span><br><span class="line">     * 提供精确的加法运算。</span><br><span class="line">     * <span class="meta">@param</span> v1 被加数</span><br><span class="line">     * <span class="meta">@param</span> v2 加数</span><br><span class="line">     * <span class="meta">@return</span> 两个参数的和</span><br><span class="line">     */</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">double</span> <span class="title">add</span><span class="params">(<span class="keyword">double</span> v1,<span class="keyword">double</span> v2)</span></span>&#123;</span><br><span class="line">        BigDecimal b1 = <span class="keyword">new</span> BigDecimal(Double.toString(v1));</span><br><span class="line">        BigDecimal b2 = <span class="keyword">new</span> BigDecimal(Double.toString(v2));</span><br><span class="line">        <span class="keyword">return</span> b1.add(b2).doubleValue();</span><br><span class="line">    &#125;</span><br><span class="line">    /`</span><br><span class="line">     * 提供精确的减法运算。</span><br><span class="line">     * <span class="meta">@param</span> v1 被减数</span><br><span class="line">     * <span class="meta">@param</span> v2 减数</span><br><span class="line">     * <span class="meta">@return</span> 两个参数的差</span><br><span class="line">     */</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">double</span> <span class="title">sub</span><span class="params">(<span class="keyword">double</span> v1,<span class="keyword">double</span> v2)</span></span>&#123;</span><br><span class="line">        BigDecimal b1 = <span class="keyword">new</span> BigDecimal(Double.toString(v1));</span><br><span class="line">        BigDecimal b2 = <span class="keyword">new</span> BigDecimal(Double.toString(v2));</span><br><span class="line">        <span class="keyword">return</span> b1.subtract(b2).doubleValue();</span><br><span class="line">    &#125;</span><br><span class="line">    /`</span><br><span class="line">     * 提供精确的乘法运算。</span><br><span class="line">     * <span class="meta">@param</span> v1 被乘数</span><br><span class="line">     * <span class="meta">@param</span> v2 乘数</span><br><span class="line">     * <span class="meta">@return</span> 两个参数的积</span><br><span class="line">     */</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">double</span> <span class="title">mul</span><span class="params">(<span class="keyword">double</span> v1,<span class="keyword">double</span> v2)</span></span>&#123;</span><br><span class="line">        BigDecimal b1 = <span class="keyword">new</span> BigDecimal(Double.toString(v1));</span><br><span class="line">        BigDecimal b2 = <span class="keyword">new</span> BigDecimal(Double.toString(v2));</span><br><span class="line">        <span class="keyword">return</span> b1.multiply(b2).doubleValue();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /`</span><br><span class="line">     * 提供（相对）精确的除法运算，当发生除不尽的情况时，精确到</span><br><span class="line">     * 小数点以后<span class="number">10</span>位，以后的数字四舍五入。</span><br><span class="line">     * <span class="meta">@param</span> v1 被除数</span><br><span class="line">     * <span class="meta">@param</span> v2 除数</span><br><span class="line">     * <span class="meta">@return</span> 两个参数的商</span><br><span class="line">     */</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">double</span> <span class="title">div</span><span class="params">(<span class="keyword">double</span> v1,<span class="keyword">double</span> v2)</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> div(v1,v2,DEF_DIV_SCALE);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /`</span><br><span class="line">     * 提供（相对）精确的除法运算。当发生除不尽的情况时，由scale参数指</span><br><span class="line">     * 定精度，以后的数字四舍五入。</span><br><span class="line">     * <span class="meta">@param</span> v1 被除数</span><br><span class="line">     * <span class="meta">@param</span> v2 除数</span><br><span class="line">     * <span class="meta">@param</span> scale 表示表示需要精确到小数点以后几位。</span><br><span class="line">     * <span class="meta">@return</span> 两个参数的商</span><br><span class="line">     */</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">double</span> <span class="title">div</span><span class="params">(<span class="keyword">double</span> v1,<span class="keyword">double</span> v2,<span class="keyword">int</span> scale)</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(scale&lt;<span class="number">0</span>)&#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(</span><br><span class="line">                <span class="string">"The scale must be a positive integer or zero"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        BigDecimal b1 = <span class="keyword">new</span> BigDecimal(Double.toString(v1));</span><br><span class="line">        BigDecimal b2 = <span class="keyword">new</span> BigDecimal(Double.toString(v2));</span><br><span class="line">        <span class="keyword">return</span> b1.divide(b2,scale,BigDecimal.ROUND_HALF_UP).doubleValue();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /`</span><br><span class="line">     * 提供精确的小数位四舍五入处理。</span><br><span class="line">     * <span class="meta">@param</span> v 需要四舍五入的数字</span><br><span class="line">     * <span class="meta">@param</span> scale 小数点后保留几位</span><br><span class="line">     * <span class="meta">@return</span> 四舍五入后的结果</span><br><span class="line">     */</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">double</span> <span class="title">round</span><span class="params">(<span class="keyword">double</span> v,<span class="keyword">int</span> scale)</span></span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(scale&lt;<span class="number">0</span>)&#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(</span><br><span class="line">                <span class="string">"The scale must be a positive integer or zero"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        BigDecimal b = <span class="keyword">new</span> BigDecimal(Double.toString(v));</span><br><span class="line">        BigDecimal one = <span class="keyword">new</span> BigDecimal(<span class="string">"1"</span>);</span><br><span class="line">        <span class="keyword">return</span> b.divide(one,scale,BigDecimal.ROUND_HALF_UP).doubleValue();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>PS：欢迎关注<a href="http://sherlockshi.github.io/">SherlockShi博客</a></p>
</blockquote>

        </div>
        
        <blockquote class="post-copyright">
            <div class="content">
               转载请注明出处：<a href="/2016/11/24/50_Java/使用BigDecimal对浮点数据进行精确计算/" target="_blank" rel="external">http://sherlockshi.github.io/2016/11/24/50_Java/使用BigDecimal对浮点数据进行精确计算/index.html</a>
            </div>
            <footer>
                <a href="http://sherlockshi.github.io">
                    <img src="http://7xlpfl.com1.z0.glb.clouddn.com/16-10-1/61240869.jpg" alt="SherlockShi">
                    SherlockShi
                </a>
            </footer>
        </blockquote>

        
        <div class="post-reward">
            <a id="rewardBtn" href="javascript:;" class="post-reward-btn waves-effect waves-circle waves-light">赏</a>
        </div>
        

        <div class="post-footer">
            
	<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/double/">double</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/float/">float</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/java/">java</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/浮点/">浮点</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/精确计算/">精确计算</a></li></ul>


            
            <div class="post-share-wrap">
                <div class="post-share" id="post-share">
    <div class="tit">分享到：</div>
    <ul class="reset share-icons">
      <li>
        <a class="weibo share-sns" href="javascript:;" data-title="微博" data-service="tsina">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      <li>
        <a class="weixin share-sns" href="javascript:;" data-title="微信" data-service="weixin">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      <li>
        <a class="qq share-sns" href="javascript:;" data-title=" QQ" data-service="cqq">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      <li>
        <a class="facebook share-sns" href="javascript:;" data-title=" Facebook" data-service="fb">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      <li>
        <a class="twitter share-sns" href="javascript:;" data-title=" Twitter" data-service="twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      <li>
        <a class="douban share-sns" href="javascript:;" data-title="豆瓣" data-service="douban">
          豆
        </a>
      </li>
    </ul>
 </div>

                <a href="javascript:;" id="share-fab" class="post-share-fab waves-effect waves-circle">
                    <i class="icon icon-share-alt icon-lg"></i>
                </a>
            </div>
            

        </div>
    </div>   

    
<nav class="post-nav flex-row flex-justify-between flex-row-reverse">
  

  
    <div class="waves-block waves-effect next">
      <a href="/2016/11/21/15_Android/1540_Widget/自定义组合控件SherlockSpinner/" id="post-next" class="post-nav-link">
        <div class="tips">Next <i class="icon icon-angle-right icon-lg icon-pl"></i></div>
        <h4 class="title">Android自定义组合控件：SherlockSpinner</h4>
      </a>
    </div>
  
</nav>


            
    
<div class="duoshuo">
	<div class="ds-thread" data-thread-key="50_Java/使用BigDecimal对浮点数据进行精确计算" data-title="使用BigDecimal对浮点数据进行精确计算【转】" data-url="http://sherlockshi.github.io/2016/11/24/50_Java/使用BigDecimal对浮点数据进行精确计算/"></div>
</div>
<script src="/js/embed.min.js?v=undefined"></script>
<script src="//cdn.bootcss.com/marked/0.3.6/marked.min.js" async="async"></script>
<script>
var duoshuoQuery = {short_name:'sherlockshi', theme: 'none'}
</script>




</article>

<div id="reward" class="reward-lay">
    <a class="reward-off" id="rewardOff" href="javascript:;"><i class="icon icon-close"></i></a>
    <h3 class="reward-title">
        <i class="icon icon-quote-left"></i>
        感谢大侠慷慨解囊～
        <i class="icon icon-quote-right"></i>
    </h3>
    <ul class="reward-items">
        
        <li>
            <img src="http://7xlpfl.com1.z0.glb.clouddn.com/16-10-1/51725532.jpg" title="微信打赏二维码" alt="微信打赏二维码">
            <p>微信</p>
        </li>
        

        
        <li>
            <img src="http://7xlpfl.com1.z0.glb.clouddn.com/16-10-1/44887159.jpg" title="支付宝打赏二维码" alt="支付宝打赏二维码">
            <p>支付宝</p>
        </li>
        
    </ul>
</div>


</div>
  </main>
  <div class="mask" id="mask"></div>
<a href="javascript:;" id="gotop" class="waves-effect waves-circle waves-light"><span class="icon icon-lg icon-chevron-up"></span></a>

<script>
var BLOG_SHARE = {
    title: "使用BigDecimal对浮点数据进行精确计算【转】",
    pic: "http://7xlpfl.com1.z0.glb.clouddn.com/16-10-1/61240869.jpg",
    summary: document.getElementsByName('summary')[0].content,
    url: "http://sherlockshi.github.io/2016/11/24/50_Java/使用BigDecimal对浮点数据进行精确计算/"
};
</script>
<div class="global-share" id="global-share">
    <div class="tit">分享到：</div>
    <ul class="reset share-icons">
      <li>
        <a class="weibo share-sns" href="javascript:;" data-title="微博" data-service="tsina">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      <li>
        <a class="weixin share-sns" href="javascript:;" data-title="微信" data-service="weixin">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      <li>
        <a class="qq share-sns" href="javascript:;" data-title=" QQ" data-service="cqq">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      <li>
        <a class="facebook share-sns" href="javascript:;" data-title=" Facebook" data-service="fb">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      <li>
        <a class="twitter share-sns" href="javascript:;" data-title=" Twitter" data-service="twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      <li>
        <a class="douban share-sns" href="javascript:;" data-title="豆瓣" data-service="douban">
          豆
        </a>
      </li>
    </ul>
 </div>


  <script src="//cdn.bootcss.com/node-waves/0.7.4/waves.min.js"></script>
<script src="/js/main.min.js?v=undefined"></script>



<div class="search-panel" id="search-panel">
    <ul class="search-result" id="search-result"></ul>
</div>
<template id="search-tpl">
<li class="item">
    <a href="/{path}" class="waves-block waves-effect">
        <div class="title ellipsis" title="{title}">{title}</div>
        <div class="flex-row flex-middle">
            <div class="tags ellipsis">
                {tags}
            </div>
            <time class="flex-col time">{date}</time>
        </div>
    </a>
</li>
</template>

<script src="/js/search.min.js?v=undefined"></script>







<!-- Google Analytics -->
<script type="text/javascript">
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-85064715-1', 'auto');
ga('send', 'pageview');

</script>
<!-- End Google Analytics -->



</body>
</html>
