<!DOCTYPE html>
<html>
    <head>
    <!-- Title -->
    
    <title>
        使用Android Studio把自己的Android library分发到JCenter | SherlockShi&#39;s Home
    </title>
    
    <!-- Favicons -->
    <link rel="icon shortcut" type="image/ico" href="/img/favicon.png">
    <link rel="icon" sizes="192x192" href="/img/favicon.png">
    <link rel="apple-touch-icon" href="/img/favicon.png">
    
    <!-- Meta & INfo -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="theme-color" content="#0097A7">
    <meta name="author" content="SherlockShi">
    <meta name="description" content="Don&#39;t be evil.">
    <meta name="keywords" content="null">
    
    <!--iOS -->
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-title" content="Title">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="HandheldFriendly" content="True">
    <meta name="MobileOptimized" content="480">
    
    <!-- Add to homescreen for Chrome on Android -->
    <meta name="mobile-web-app-capable" content="yes">
    
    <!-- Add to homescreen for Safari on iOS -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="apple-mobile-web-app-title" content="SherlockShi&#39;s Home">
    
    <!-- The Open Graph protocol -->
    <meta property="og:url" content="http://sherlockshi.github.io">
    <meta property="og:type" content="blog">
    <meta property="og:title" content="使用Android Studio把自己的Android library分发到JCenter | SherlockShi&#39;s Home">
    <meta property="og:description" content="Don&#39;t be evil.">
    
     <!--[if lte IE 9]>
        <link rel="stylesheet" href="/css/ie-blocker.css">
        
        
            <script src="/js/ie-blocker.zhCN.js"></script>
        
    <![endif]-->
    
    <!-- Import CSS -->
    <link rel="stylesheet" href="/css/material.min.css">
    <link rel="stylesheet" href="/css/style.min.css">
    <!-- Config CSS -->


<!-- Other Styles -->
<style>
	body, html{
		font-family: Roboto, "Helvetica Neue", Helvetica, "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei", "微软雅黑", Arial, sans-serif;
	}
	
    a{
        color: #00838F
    }
    
    .mdl-card__media,
    #search-label,
    #search-form-label:after,
    #scheme-Paradox .hot_tags-count,
    #scheme-Paradox .sidebar_archives-count,
    #scheme-Paradox .sidebar-colored .sidebar-header,
    #scheme-Paradox .sidebar-colored .sidebar-badge{
        background-color: #0097A7 !important
    }
    
	/* Sidebar User Drop Down Menu Text Color */
	#scheme-Paradox .sidebar-colored .sidebar-nav>.dropdown>.dropdown-menu>li>a:hover,
    #scheme-Paradox .sidebar-colored .sidebar-nav>.dropdown>.dropdown-menu>li>a:focus{
        color: #0097A7 !important
    }
    
    #post_entry-right-info,
    .sidebar-colored .sidebar-nav li:hover > a,
    .sidebar-colored .sidebar-nav li:hover > a i,
    .sidebar-colored .sidebar-nav li > a:hover,
    .sidebar-colored .sidebar-nav li > a:hover i,
    .sidebar-colored .sidebar-nav li > a:focus i,
    .sidebar-colored .sidebar-nav > .open > a,
    .sidebar-colored .sidebar-nav > .open > a:hover,
    .sidebar-colored .sidebar-nav > .open > a:focus,
    #ds-reset #ds-ctx .ds-ctx-entry .ds-ctx-head a{
        color: #0097A7 !important
    }
    
    .toTop{
        background: #757575 !important
    }
		
	.material-layout .material-post>.material-nav,
	.material-layout .material-index>.material-nav,
	.material-nav a{
		color: #757575;
	}
		
	#scheme-Paradox .MD-burger-layer {
		background-color: #757575;
	}

	#scheme-Paradox #post-toc-trigger-btn{
		color: #757575;
	}
	
	.post-toc a:hover{
		color: #00838F;
		text-decoration: underline;
	}
</style>


<!-- Theme Background Related-->

    <style>
        body{
            background-color: #F5F5F5
        }
		
		/* blog_info bottom background */
        #scheme-Paradox .material-layout .something-else .mdl-card__supporting-text{
            background-color: #fff;
        }
    </style>




<!-- Fade Effect -->

    <style>
        .fade {
            transition: all 800ms linear;
            -webkit-transform: translate3d(0,0,0);
            -moz-transform: translate3d(0,0,0);
            -ms-transform: translate3d(0,0,0);
            -o-transform: translate3d(0,0,0);
            transform: translate3d(0,0,0);
            opacity: 1;
        }

        .fade.out{
            opacity: 0;
        }
    </style>

	<script src="/js/jquery.min.js"></script>
	
	<link rel="stylesheet" href="/css/highlight/solarized-white.css">
	
	<!-- UC Browser Compatible-->
	<script>
		var agent = navigator.userAgent.toLowerCase();
		if(agent.indexOf('ucbrowser')>0) {
			document.write('<link rel="stylesheet" href="/css/uc.css">');
		   alert('由于 UC 浏览器使用极旧的内核，而本网站使用了一些新的特性。\n为了您能更好的浏览，推荐使用 Chrome 或 Firefox 浏览器。');
		}
	</script>
    
    <!-- Custom Head -->
    
        
			<!-- GoogleAnalytics -->
			<script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
ga('create', 'UA-85064715-1', 'auto'); ga('send', 'pageview');
</script>
        
    
</head>
	
	

    <body id="scheme-Paradox">

		
        <div class="material-layout  mdl-js-layout has-drawer is-upgraded">
				
			
			
            <!-- Main Container -->
            <main class="material-layout__content" id="main">
				
                <!-- Top Anchor -->
                <div id="top"></div>
				
				
                <!-- Hamburger Button -->
                <button class="MD-burger-icon sidebar-toggle">
                    <span class="MD-burger-layer"></span>
                </button>
				
				
                
	<!-- Back Button -->
<!--
	<div class="material-back" id="backhome-div" tabindex="0">
		<a class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon" href="#" onclick="window.history.back();return false;" target="_self" role="button" data-upgraded=",MaterialButton,MaterialRipple">
			<i class="material-icons" role="presentation">arrow_back</i>
			<span class="mdl-button__ripple-container">
				<span class="mdl-ripple"></span>
			</span>
		</a>
	</div>			
-->
	<!-- Left aligned menu below button -->
	<button id="post-toc-trigger-btn"
			class="mdl-button mdl-js-button mdl-button--icon">
	  <i class="material-icons">format_list_numbered</i>
	</button>

	<ul class="post-toc-wrap mdl-menu mdl-menu--bottom-left mdl-js-menu mdl-js-ripple-effect"
		for="post-toc-trigger-btn">
			
			<ol class="post-toc"><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#前言"><span class="post-toc-number">1.</span> <span class="post-toc-text">前言</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#一、Android-studio-是从哪里得到库的？"><span class="post-toc-number">2.</span> <span class="post-toc-text">一、Android studio 是从哪里得到库的？</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#1-JCenter"><span class="post-toc-number">2.1.</span> <span class="post-toc-text">1. JCenter</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#2-Maven-Central"><span class="post-toc-number">2.2.</span> <span class="post-toc-text">2. Maven Central</span></a></li></ol></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#二、理解JCenter和Maven-Central"><span class="post-toc-number">3.</span> <span class="post-toc-text">二、理解JCenter和Maven Central</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#三、gradle是如何从仓库上获取一个library的？"><span class="post-toc-number">4.</span> <span class="post-toc-text">三、gradle是如何从仓库上获取一个library的？</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#四、了解aar文件"><span class="post-toc-number">5.</span> <span class="post-toc-text">四、了解aar文件</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#五、如何上传library到JCenter"><span class="post-toc-number">6.</span> <span class="post-toc-text">五、如何上传library到JCenter</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#1-在bintray上创建package"><span class="post-toc-number">6.1.</span> <span class="post-toc-text">1. 在bintray上创建package</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#2-准备一个Android-Studio项目"><span class="post-toc-number">6.2.</span> <span class="post-toc-text">2. 准备一个Android Studio项目</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#3-把library上传到你的bintray空间"><span class="post-toc-number">6.3.</span> <span class="post-toc-text">3. 把library上传到你的bintray空间</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#4-同步bintray用户仓库到JCenter"><span class="post-toc-number">6.4.</span> <span class="post-toc-text">4. 同步bintray用户仓库到JCenter</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#5-用法"><span class="post-toc-number">6.5.</span> <span class="post-toc-text">5. 用法</span></a></li></ol></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#六、踩坑经历"><span class="post-toc-number">7.</span> <span class="post-toc-text">六、踩坑经历</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#1-编译上传时，提示jar包未找到"><span class="post-toc-number">7.1.</span> <span class="post-toc-text">1. 编译上传时，提示jar包未找到</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#2-Javadoc-generation-failed"><span class="post-toc-number">7.2.</span> <span class="post-toc-text">2. Javadoc generation failed</span></a></li></ol></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#七、参考"><span class="post-toc-number">8.</span> <span class="post-toc-text">七、参考</span></a></li></ol>
		
<!--			<li class="mdl-menu__item">Some Action</li>-->
	</ul>


<!-- Layouts -->

    <!-- Post Module -->
    <div class="material-post_container">
		
        <div class="material-post mdl-grid">
            <div class="mdl-card mdl-shadow--4dp mdl-cell mdl-cell--12-col">

                <!-- Post Header(Thumbnail & Title) -->
                
	<!-- Paradox Post Header -->
	
		
			<!-- Random Thumbnail -->
			<div class="post_thumbnail-random mdl-card__media mdl-color-text--grey-50">
				<script>
    
    var randomNum;
    randomNum = Math.floor(Math.random() * 7 + 1);
    
    $(".post_thumbnail-random").css('background-image', 'url(' + '/img/random/' + randomNum + '.png' + ')');
    
</script>

		
	
        <p class="article-headline-p">
            使用Android Studio把自己的Android library分发到JCenter
        </p>
    </div>

	

				
				
					<!-- Paradox Post Info -->
					<div class="mdl-color-text--grey-700 mdl-card__supporting-text meta">
    
    <!-- Author Avatar -->
    <div id="author-avatar">
        <img src="/img/avatar.png" width="44px" height="44px" alt="Author Avatar"/>
    </div>
    <!-- Author Name & Date -->
    <div>
        <strong>SherlockShi</strong>
        <span>9月 29, 2016</span>
    </div>
    
    <div class="section-spacer"></div>
	
    <!-- Favorite -->
<!--
    <button id="article-functions-like-button" class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon btn-like">
        <i class="material-icons" role="presentation">favorite</i>
        <span class="visuallyhidden">favorites</span>
    </button>
-->
    
    <!-- Tags (bookmark) -->
    <button id="article-functions-viewtags-button" class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon">
        <i class="material-icons" role="presentation">bookmark</i>
        <span class="visuallyhidden">bookmark</span>
    </button>
    <ul class="mdl-menu mdl-menu--bottom-right mdl-js-menu mdl-js-ripple-effect" for="article-functions-viewtags-button">
        <li class="mdl-menu__item">
        <a class="post_tag-link" href="/tags/Android/">Android</a></li><li class="mdl-menu__item"><a class="post_tag-link" href="/tags/Android-Studio/">Android Studio</a></li><li class="mdl-menu__item"><a class="post_tag-link" href="/tags/JCenter/">JCenter</a></li><li class="mdl-menu__item"><a class="post_tag-link" href="/tags/Maven/">Maven</a></li><li class="mdl-menu__item"><a class="post_tag-link" href="/tags/library/">library</a>
    </ul>
    
    <!-- Share -->
    <button id="article-fuctions-share-button" class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon">
    <i class="material-icons" role="presentation">share</i>
    <span class="visuallyhidden">share</span>
</button>
<ul class="mdl-menu mdl-menu--bottom-right mdl-js-menu mdl-js-ripple-effect" for="article-fuctions-share-button">
    
    
    <!-- Leancloud Views -->
    <a class="post_share-link" href="#">
        <li class="mdl-menu__item">
            <span id="/2016/09/29/15_Android/1555_Maven/使用Android Studio把自己的Android library分发到jCenter/" class="leancloud-views_num" data-flag-title="使用Android Studio把自己的Android library分发到JCenter">
     &nbsp;浏览量
</span>
        </li>
    </a>
    
    
    
    <!-- Busuanzi Views -->
    <a class="post_share-link" href="#">
        <li class="mdl-menu__item">
            <span id="busuanzi_container_page_pv">
                <span id="busuanzi_value_page_pv"></span>&nbsp;浏览量
            </span>
        </li>
    </a>
    
    
    <!-- Share Twitter -->
    <a class="post_share-link" href="https://twitter.com/intent/tweet?text=使用Android Studio把自己的Android library分发到JCenter&url=http://sherlockshi.github.io//2016/09/29/15_Android/1555_Maven/使用Android Studio把自己的Android library分发到jCenter/index.html&via=SherlockShi" target="_blank">
        <li class="mdl-menu__item">
            分享到 Twitter
        </li>
    </a>
    
    <!-- Share Google+ -->
    <a class="post_share-link" href="https://plus.google.com/share?url=http://sherlockshi.github.io//2016/09/29/15_Android/1555_Maven/使用Android Studio把自己的Android library分发到jCenter/index.html" target="_blank">
        <li class="mdl-menu__item">
            分享到 Google+
        </li>
    </a>
    
    <!-- Share Weibo -->
    <a class="post_share-link" href="http://service.weibo.com/share/share.php?appkey=&title=使用Android Studio把自己的Android library分发到JCenter&url=http://sherlockshi.github.io//2016/09/29/15_Android/1555_Maven/使用Android Studio把自己的Android library分发到jCenter/index.html&pic=&searchPic=false&style=simple" target="_blank">
        <li class="mdl-menu__item">
            分享到微博
        </li>
    </a>
</ul>
</div>
				

                <!-- Post Content -->
                <div id="post-content" class="markdown-Github mdl-color-text--grey-700 mdl-card__supporting-text fade out">
	
		<h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>如果你想在Android Studio中引入一个library到你的项目，你只需添加如下的一行代码到模块的build.gradle文件中:</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">compile <span class="string">'com.sherlockshi.widget:aspectratioimageview:1.0.1'</span></span><br></pre></td></tr></table></figure>
<p>就是如此简单的一行代码，你就可以使用这个library了。</p>
<a id="more"></a>
<p>酷呆了。不过你可能很好奇Android Studio是从哪里得到这个library的。这篇文章将详细讲解这是怎么回事，包括如何把你的库发布出去分享给世界各地的其他开发者，这样不仅可以让世界更美好，还可以耍一次酷。</p>
<h1 id="一、Android-studio-是从哪里得到库的？"><a href="#一、Android-studio-是从哪里得到库的？" class="headerlink" title="一、Android studio 是从哪里得到库的？"></a>一、Android studio 是从哪里得到库的？</h1><p>先从这个简单的问题开始，我相信不是每个人都完全明白Android studio 是从哪里得到这些library的。莫非就是Android studio 从google搜索然后下载了一个合适的给我们？</p>
<p>呵呵，没那么复杂。Android Studio是从build.gradle里面定义的Maven 仓库服务器上下载library的。Apache Maven是Apache开发的一个工具，提供了用于贡献library的文件服务器。总的来说，只有两个标准的Android library文件服务器：<code>JCenter</code> 和 <code>Maven Central</code>。</p>
<h2 id="1-JCenter"><a href="#1-JCenter" class="headerlink" title="1. JCenter"></a>1. JCenter</h2><p>JCenter是一个由<code>bintray.com</code>维护的Maven仓库 。你可以在<a href="http://jcenter.bintray.com/" target="_blank" rel="external">这里</a>看到整个仓库的内容。<br>我们在项目的build.gradle 文件中如下定义仓库，就能使用JCenter了：</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">allprojects &#123;</span><br><span class="line">    repositories &#123;</span><br><span class="line">        jcenter()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="2-Maven-Central"><a href="#2-Maven-Central" class="headerlink" title="2. Maven Central"></a>2. Maven Central</h2><p>Maven Central 则是由sonatype.org维护的Maven仓库。你可以在这里看到整个仓库。  </p>
<blockquote>
<p>注：不管是JCenter还是Maven Central ，两者都是Maven仓库  </p>
</blockquote>
<p>我们在项目的build.gradle 文件中如下定义仓库，就能使用Maven Central了：</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">allprojects &#123;</span><br><span class="line">    repositories &#123;</span><br><span class="line">        mavenCentral()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>注意，虽然JCenter和Maven Central 都是标准的 android library仓库，但是它们维护在完全不同的服务器上，由不同的人提供内容，两者之间毫无关系。在JCenter上有的可能 Maven Central 上没有，反之亦然。</p>
<p>除了两个标准的服务器之外，如果我们使用的library的作者是把该library放在自己的服务器上，我们还可以自己定义特有的Maven仓库服务器。Twitter的Fabric.io 就是这种情况，它们在 <a href="https://maven.fabric.io/public" target="_blank" rel="external">https://maven.fabric.io/public</a> 上维护了一个自己的Maven仓库。如果你想使用Fabric.io的library，你必须自己如下定义仓库的url。</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">repositories &#123;</span><br><span class="line">    maven &#123; url <span class="string">'https://maven.fabric.io/public'</span> &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>然后在里面使用相同的方法获取一个library:</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">compile <span class="string">'com.crashlytics.sdk.android:crashlytics:2.2.4@aar'</span></span><br></pre></td></tr></table></figure>
<p>但是将library上传到标准的服务器与自建服务器，哪种方法更好呢？当然是前者。如果将我们的library公开，其他开发者除了一行定义依赖名的代码之外不需要定义任何东西。因此这篇文章中，我们将只关注对开发者更友好的JCenter 和 Maven Central 。</p>
<p>实际上可以在Android Studio上使用的除了Maven 仓库之外还有另外一种仓库：Ivy 仓库 。但是根据我的经验来看，我还没看到任何人用过它，包括我，因此本文就直接忽略了。</p>
<h1 id="二、理解JCenter和Maven-Central"><a href="#二、理解JCenter和Maven-Central" class="headerlink" title="二、理解JCenter和Maven Central"></a>二、理解JCenter和Maven Central</h1><p>为何有两个标准的仓库？</p>
<p>事实上两个仓库都具有相同的使命：提供Java或者Android library服务。上传到哪个（或者都上传）取决于开发者。</p>
<p>起初，Android Studio 选择Maven Central作为默认仓库。如果你使用老版本的Android Studio创建一个新项目，mavenCentral()会自动的定义在build.gradle中。</p>
<p>但是Maven Central的最大问题是对开发者不够友好。上传library异常困难。上传上去的开发者都是某种程度的极客。同时还因为诸如安全方面的其他原因，Android Studio团队决定把默认的仓库替换成JCenter。正如你看到的，一旦使用最新版本的Android Studio创建一个项目，JCenter()自动被定义，而不是mavenCentral()。</p>
<p>有许多将Maven Central替换成JCenter的理由，下面是几个主要的原因。</p>
<ul>
<li>JCenter通过CDN发送library，开发者可以享受到更快的下载体验。</li>
<li>JCenter是全世界最大的Java仓库，因此在Maven Central 上有的，在JCenter上也极有可能有。换句话说JCenter是Maven Central的<code>超集</code>。</li>
<li>上传library到仓库很简单，不需要像在Maven Central上做很多复杂的事情。</li>
<li>友好的用户界面</li>
<li>如果你想把library上传到Maven Central ，你可以在bintray网站上直接点击一个按钮就能实现。</li>
</ul>
<p>基于上面的原因以及我自己的经验，可以说替换到JCenter是明智之举。</p>
<p>所以我们这篇文章将把重心放在JCenter，反正如果你能成功把library放在JCenter，转到 Maven Central 是非常容易的事情。</p>
<h1 id="三、gradle是如何从仓库上获取一个library的？"><a href="#三、gradle是如何从仓库上获取一个library的？" class="headerlink" title="三、gradle是如何从仓库上获取一个library的？"></a>三、gradle是如何从仓库上获取一个library的？</h1><p>在讨论如何上传library到JCenter之前，我们先看看gradle是如何从仓库获取library的。比如我们在 build.gradle输入如下代码的时候，这些库是如果奇迹般下载到我们的项目中的。</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">compile <span class="string">'com.sherlockshi.widget:aspectratioimageview:1.0.1'</span></span><br></pre></td></tr></table></figure>
<p>一般来说，我们需要知道library的字符串形式，包含3部分</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">GROUP_ID:</span><span class="string">ARTIFACT_ID:</span>VERSION</span><br></pre></td></tr></table></figure>
<p>上面的例子中，GROUP_ID是<code>com.sherlockshi.widget</code>，ARTIFACT_ID是<code>aspectratioimageview</code>，VERSION是<code>1.0.1</code>。</p>
<p>GROUP_ID定义了library的group。有可能在同样的上下文中存在多个不同功能的library。如果library具有相同的group，那么它们将共享一个GROUP_ID。通常我们以开发者包名紧跟着library的group名称来命名，比如com.squareup.picasso。然后ARTIFACT_ID中是library的真实名称。至于VERSION，就是版本号而已，虽然可以是任意文字，但是我建议设置为x.y.z的形式，如果喜欢还可以加上beta这样的后缀。</p>
<p>下面是Square library的一个例子。你可以看到每个都可以很容易的分辨出library和开发者的名称。</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">dependencies &#123;</span><br><span class="line">  compile <span class="string">'com.squareup:otto:1.3.7'</span></span><br><span class="line">  compile <span class="string">'com.squareup.picasso:picasso:2.5.2'</span></span><br><span class="line">  compile <span class="string">'com.squareup.okhttp:okhttp:2.4.0'</span></span><br><span class="line">  compile <span class="string">'com.squareup.retrofit:retrofit:1.9.0'</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>那么在添加了上面的依赖之后会发生什么呢？简单。Gradle会询问Maven仓库服务器这个library是否存在，如果是，gradle会获得请求library的路径，一般这个路径都是这样的形式：GROUP_ID/ARTIFACT_ID/VERSION_ID。比如可以在<a href="http://jcenter.bintray.com/com/squareup/otto/1.3.7" target="_blank" rel="external">http://jcenter.bintray.com/com/squareup/otto/1.3.7</a> 和 <a href="https://oss.sonatype.org/content/repositories/releases/com/squareup/otto/1.3.7/" target="_blank" rel="external">https://oss.sonatype.org/content/repositories/releases/com/squareup/otto/1.3.7/</a><br>下获得com.squareup:otto:1.3.7的library文件。</p>
<p>然后Android Studio 将下载这些文件到我们的电脑上，与我们的项目一起编译。整个过程就是这么简单，一点都不复杂。</p>
<p>我相信你应该清楚的知道从仓库上下载的library只是存储在仓库服务器上的jar 或者aar文件而已。有点类似于自己去下载这些文件，拷贝然后和项目一起编译。但是使用gradle依赖管理的最大好处是你除了添加几行文字之外啥也不做。library一下子就可以在项目中使用了。</p>
<h1 id="四、了解aar文件"><a href="#四、了解aar文件" class="headerlink" title="四、了解aar文件"></a>四、了解aar文件</h1><p>等等，我刚才说了仓库中存储的有两种类型的library：jar 和 aar。jar文件大家都知道，但是什么是aar文件呢？</p>
<p>aar文件时在jar文件之上开发的。之所以有它是因为有些Android Library需要植入一些安卓特有的文件，比如AndroidManifest.xml，资源文件，Assets或者JNI。这些都不是jar文件的标准。</p>
<p>因此aar文件就时发明出来包含所有这些东西的。总的来说它和jar一样只是普通的zip文件，不过具有不同的文件结构。jar文件以classes.jar的名字被嵌入到aar文件中。其余的文件罗列如下：<br>– /AndroidManifest.xml (mandatory)<br>– /classes.jar (mandatory)<br>– /res/ (mandatory)<br>– /R.txt (mandatory)<br>– /assets/ (optional)<br>– /libs/.jar (optional)<br>– /jni//.so (optional)<br>– /proguard.txt (optional)<br>– /lint.jar (optional)<br>可以看到.aar文件是专门为安卓设计的。因此这篇文章将教你如何创建与上传一个aar形式的library。</p>
<h1 id="五、如何上传library到JCenter"><a href="#五、如何上传library到JCenter" class="headerlink" title="五、如何上传library到JCenter"></a>五、如何上传library到JCenter</h1><p>我相信你已经知道了仓库系统的大体工作原理。现在我们来开始最重要的部分：上传。这个任务和如何上传library文件到<a href="http://jcenter.bintray.com" target="_blank" rel="external">http://jcenter.bintray.com</a> 一样简单。如果做到，这个library就算发布了。好吧，有两个需要考虑：如何创建aar文件以及如何上传构建的文件到仓库。</p>
<p>虽然需要若干步骤，但是我还是想强调这事并不复杂，因为已经准备好了所有事情。整个过程如下图：<br><img src="http://7xlpfl.com1.z0.glb.clouddn.com/16-10-1/64566263.jpg" alt=""></p>
<p>因为细节比较多，我分为以下几个部分，一步一步的详细解释清楚。</p>
<h2 id="1-在bintray上创建package"><a href="#1-在bintray上创建package" class="headerlink" title="1. 在bintray上创建package"></a>1. 在bintray上创建package</h2><p><strong>第一步</strong></p>
<p>在bintray.com上注册一个账号。（注册过程很简单，自己完成，也可以直接使用Github账号）</p>
<p><strong>第二步</strong></p>
<p>完成注册之后，登录网站，然后点击+号<br><img src="http://7xlpfl.com1.z0.glb.clouddn.com/16-10-1/13698614.jpg" alt=""></p>
<p><strong>第三步</strong></p>
<p>输入Repository相关信息，创建一个Repository<br><img src="http://7xlpfl.com1.z0.glb.clouddn.com/16-10-1/26172115.jpg" alt=""></p>
<p><strong>第四步</strong></p>
<p>点击打开刚才创建好的Repository<br><img src="http://7xlpfl.com1.z0.glb.clouddn.com/16-10-1/78523250.jpg" alt=""></p>
<p><strong>第五步</strong></p>
<p>点击<code>Add New Package</code>，为我们的library创建一个新的package<br><img src="http://7xlpfl.com1.z0.glb.clouddn.com/16-10-1/98586757.jpg" alt=""></p>
<p><strong>第六步</strong></p>
<p>按页面要求填写相关信息<br><img src="http://7xlpfl.com1.z0.glb.clouddn.com/16-10-2/47591545.jpg" alt=""></p>
<p>完工！现在你有了自己在Bintray上的Maven仓库，可以准备上传library到上面了。</p>
<h2 id="2-准备一个Android-Studio项目"><a href="#2-准备一个Android-Studio项目" class="headerlink" title="2. 准备一个Android Studio项目"></a>2. 准备一个Android Studio项目</h2><p>很多情况下，我们需要同时上传一个以上的library到仓库，也可能不需要上传东西。因此我建议最好将每部分分成一个Module。最好分成两个module，一个Application Module一个Library Module。Application Module用于展示库的用法，Library Module是library的源代码。如果你的项目有一个以上的library，尽量创建另外的module：1个 module对应1 个library。<br><img src="http://7xlpfl.com1.z0.glb.clouddn.com/16-10-1/61816057.jpg" alt=""><br>我相信大家知道如何创建一个新的module，因此就不会深入讲解这个问题了。其实很简单，基本就是选择 <code>File</code> -&gt; <code>New</code> -&gt; <code>Module</code>，选择<code>Android Library</code>，然后就完了。</p>
<p><strong>添加bintray插件</strong></p>
<p>我们需要修改<code>项目的build.gradle</code>文件中的依赖部分，如下：</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">dependencies &#123;</span><br><span class="line">    ...</span><br><span class="line">    classpath <span class="string">'com.jfrog.bintray.gradle:gradle-bintray-plugin:1.6'</span></span><br><span class="line">    classpath <span class="string">'com.github.dcendents:android-maven-gradle-plugin:1.4.1'</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>配置Bintray账号以及开发者信息</strong></p>
<p>接下来我们将修改<code>local.properties</code>。在里面定义api key的用户名以及被创建key的密码，用于bintray的认证。之所以要把这些东西放在这个文件是因为这些信息时比较敏感的，不应该到处分享，包括版本控制里面。幸运的是在创建项目的时候local.properties文件就已经被添加到.gitignore了。因此这些敏感数据不会被误传到git服务器。</p>
<p>下面是要添加的代码：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">#bintray</span><br><span class="line">bintray.user=******</span><br><span class="line">bintray.apikey=******</span><br><span class="line"></span><br><span class="line">#developer</span><br><span class="line">developer.id=******</span><br><span class="line">developer.name=******</span><br><span class="line">developer.email=******</span><br></pre></td></tr></table></figure>
<ul>
<li>bintray.user：你的Bintray的用户名</li>
<li>bintray.apikey：你的的Bintray的API Key,可以在<code>Edit Profile</code>页面的 <code>API Key</code> 选项卡中找到</li>
<li>developer.id：通常是你在开源社区的昵称</li>
<li>developer.name：你的姓名</li>
<li>developer.email：你的邮箱</li>
</ul>
<p><strong>配置项目信息</strong></p>
<p>在<code>library module</code>目录下新建<code>project.properties</code>文件，输入以下内容：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">#project</span><br><span class="line">project.name=AspectRatioImageView</span><br><span class="line">project.bintrayRepo=android-widgets</span><br><span class="line">project.groupId=com.sherlockshi.widget</span><br><span class="line">project.artifactId=aspectratioimageview</span><br><span class="line">project.packaging=aar</span><br><span class="line">project.siteUrl=https://github.com/SherlockShi/AspectRatioImageView</span><br><span class="line">project.gitUrl=https://github.com/SherlockShi/AspectRatioImageView.git</span><br><span class="line"></span><br><span class="line">#javadoc</span><br><span class="line">javadoc.name=AspectRatioImageView</span><br></pre></td></tr></table></figure>
<ul>
<li>project.name：项目名称</li>
<li>project.groupId：项目组ID</li>
<li>project.artifactId：项目ID</li>
<li>project.packaging：包类型，Android库是aar</li>
<li>project.siteUrl：项目官方网站的地址，没有的话就用Github上的地址</li>
<li>project.gitUrl：项目的Git地址</li>
<li>javadoc.name：生成的javadoc打开后主页显示的名称，通常跟项目名称一样即可</li>
</ul>
<p><strong>配置bintrayUpload.gradle</strong></p>
<blockquote>
<p>本步骤也可以直接使用别人打包好的脚本引入即可，但本文主要介绍原理，有需要的可以自己搜索。</p>
</blockquote>
<ul>
<li>首先在<code>library module</code>目录下新建<code>bintrayUpload.gradle</code>文件，直接粘贴以下内容：  </li>
</ul>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br></pre></td><td class="code"><pre><span class="line">apply <span class="string">plugin:</span> <span class="string">'com.github.dcendents.android-maven'</span></span><br><span class="line">apply <span class="string">plugin:</span> <span class="string">'com.jfrog.bintray'</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// load properties</span></span><br><span class="line">Properties properties = <span class="keyword">new</span> Properties()</span><br><span class="line">File localPropertiesFile = project.file(<span class="string">"../local.properties"</span>);</span><br><span class="line"><span class="keyword">if</span>(localPropertiesFile.exists())&#123;</span><br><span class="line">    properties.load(localPropertiesFile.newDataInputStream())</span><br><span class="line">&#125;</span><br><span class="line">File projectPropertiesFile = project.file(<span class="string">"project.properties"</span>);</span><br><span class="line"><span class="keyword">if</span>(projectPropertiesFile.exists())&#123;</span><br><span class="line">    properties.load(projectPropertiesFile.newDataInputStream())</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// read properties</span></span><br><span class="line"><span class="keyword">def</span> projectName = properties.getProperty(<span class="string">"project.name"</span>)</span><br><span class="line"><span class="keyword">def</span> projectBintrayRepo = properties.getProperty(<span class="string">"project.bintrayRepo"</span>)</span><br><span class="line"><span class="keyword">def</span> projectGroupId = properties.getProperty(<span class="string">"project.groupId"</span>)</span><br><span class="line"><span class="keyword">def</span> projectArtifactId = properties.getProperty(<span class="string">"project.artifactId"</span>)</span><br><span class="line"><span class="keyword">def</span> projectVersionName = android.defaultConfig.versionName</span><br><span class="line"><span class="keyword">def</span> projectPackaging = properties.getProperty(<span class="string">"project.packaging"</span>)</span><br><span class="line"><span class="keyword">def</span> projectSiteUrl = properties.getProperty(<span class="string">"project.siteUrl"</span>)</span><br><span class="line"><span class="keyword">def</span> projectGitUrl = properties.getProperty(<span class="string">"project.gitUrl"</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> developerId = properties.getProperty(<span class="string">"developer.id"</span>)</span><br><span class="line"><span class="keyword">def</span> developerName = properties.getProperty(<span class="string">"developer.name"</span>)</span><br><span class="line"><span class="keyword">def</span> developerEmail = properties.getProperty(<span class="string">"developer.email"</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> bintrayUser = properties.getProperty(<span class="string">"bintray.user"</span>)</span><br><span class="line"><span class="keyword">def</span> bintrayApikey = properties.getProperty(<span class="string">"bintray.apikey"</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> javadocName = properties.getProperty(<span class="string">"javadoc.name"</span>)</span><br><span class="line"></span><br><span class="line">group = projectGroupId</span><br><span class="line"></span><br><span class="line"><span class="comment">// This generates POM.xml with proper parameters</span></span><br><span class="line">install &#123;</span><br><span class="line">    repositories.mavenInstaller &#123;</span><br><span class="line">        pom &#123;</span><br><span class="line">            project &#123;</span><br><span class="line">                name projectName</span><br><span class="line">                groupId projectGroupId</span><br><span class="line">                artifactId projectArtifactId</span><br><span class="line">                version projectVersionName</span><br><span class="line">                packaging projectPackaging</span><br><span class="line">                url projectSiteUrl</span><br><span class="line">                licenses &#123;</span><br><span class="line">                    license &#123;</span><br><span class="line">                        name <span class="string">'The Apache Software License, Version 2.0'</span></span><br><span class="line">                        url <span class="string">'http://www.apache.org/licenses/LICENSE-2.0.txt'</span></span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                developers &#123;</span><br><span class="line">                    developer &#123;</span><br><span class="line">                        id developerId</span><br><span class="line">                        name developerName</span><br><span class="line">                        email developerEmail</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                scm &#123;</span><br><span class="line">                    connection projectGitUrl</span><br><span class="line">                    developerConnection projectGitUrl</span><br><span class="line">                    url projectSiteUrl</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;.writeTo(<span class="string">"$buildDir/poms/pom-default.xml"</span>).writeTo(<span class="string">"pom.xml"</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// This generates sources.jar</span></span><br><span class="line">task sourcesJar(<span class="string">type:</span> Jar) &#123;</span><br><span class="line">    from android.sourceSets.main.java.srcDirs</span><br><span class="line">    classifier = <span class="string">'sources'</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">task javadoc(<span class="string">type:</span> Javadoc) &#123;</span><br><span class="line">    source = android.sourceSets.main.java.srcDirs</span><br><span class="line">    classpath += project.files(android.getBootClasspath().join(File.pathSeparator))</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// This generates javadoc.jar</span></span><br><span class="line">task javadocJar(<span class="string">type:</span> Jar, <span class="string">dependsOn:</span> javadoc) &#123;</span><br><span class="line">    classifier = <span class="string">'javadoc'</span></span><br><span class="line">    from javadoc.destinationDir</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">artifacts &#123;</span><br><span class="line">    archives javadocJar</span><br><span class="line">    archives sourcesJar</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// javadoc configuration</span></span><br><span class="line">javadoc &#123;</span><br><span class="line">    options&#123;</span><br><span class="line">        encoding <span class="string">"UTF-8"</span></span><br><span class="line">        charSet <span class="string">'UTF-8'</span></span><br><span class="line">        author <span class="literal">true</span></span><br><span class="line">        version projectVersionName</span><br><span class="line">        links <span class="string">"http://docs.oracle.com/javase/7/docs/api"</span></span><br><span class="line">        title javadocName</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// bintray configuration</span></span><br><span class="line">bintray &#123;</span><br><span class="line">    user = bintrayUser</span><br><span class="line">    key = bintrayApikey</span><br><span class="line">    configurations = [<span class="string">'archives'</span>]</span><br><span class="line">    pkg &#123;</span><br><span class="line">        repo = projectBintrayRepo</span><br><span class="line">        name = projectName</span><br><span class="line">        websiteUrl = projectSiteUrl</span><br><span class="line">        vcsUrl = projectGitUrl</span><br><span class="line">        licenses = [<span class="string">"Apache-2.0"</span>]</span><br><span class="line">        publish = <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>然后修改你的<code>library module</code>的<code>build.gradle</code>文件，在最后加上：</li>
</ul>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apply <span class="string">from:</span> <span class="string">"bintrayUpload.gradle"</span></span><br></pre></td></tr></table></figure>
<h2 id="3-把library上传到你的bintray空间"><a href="#3-把library上传到你的bintray空间" class="headerlink" title="3. 把library上传到你的bintray空间"></a>3. 把library上传到你的bintray空间</h2><p>打开终端进入项目目录下，执行<code>gradlew bintrayUpload</code>命令即可</p>
<p>另外，如果你的本地已经配置了Gradle了，那么执行<code>gradle bintrayUpload</code>命令也可以。gradlew是Gradle的一层封装，如果你本地没有安装Gradle, gradlew就会自动下载Gradle。</p>
<p>在bintray的网页上检查一下你的package。你会发现在版本区域的变化。<br><img src="http://7xlpfl.com1.z0.glb.clouddn.com/16-10-1/52163301.jpg" alt=""></p>
<p>点击进去，进入Files选项卡，你会看见那里有我们所上传的library文件。</p>
<p>恭喜，你的library终于放在了互联网上，任何人都可以使用了！</p>
<p>不过也别高兴过头，library现在仍然只是在你自己的Maven仓库，而不是在JCenter上。如果有人想使用你的library，他必须定义仓库的url，如下：</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">repositories &#123;</span><br><span class="line">    maven &#123;</span><br><span class="line">        url <span class="string">'https://dl.bintray.com/sherlockshi/android-widgets/'</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">dependencies &#123;</span><br><span class="line">    compile <span class="string">'com.sherlockshi.widgets:aspectratioimageview:1.0.1'</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>你可以在bintray的web界面找到自己Maven仓库的url，或者直接吧nuuneoi替换成你的bintray用户名（因为前面部分其实都是一样的）。我还建议你直接访问那个链接，看看里面到底是什么。</p>
<p>但是，就如我们前面所讲的那样，让开发者去定义url这种复杂的事情并不是分享library的最佳方式。想象一下，使用10个library不得添加10个url？所以为了更好的体验，我们把library从自己的仓库传到JCenter上。</p>
<h2 id="4-同步bintray用户仓库到JCenter"><a href="#4-同步bintray用户仓库到JCenter" class="headerlink" title="4. 同步bintray用户仓库到JCenter"></a>4. 同步bintray用户仓库到JCenter</h2><p>把library同步到JCenter非常容易，只需访问网页在package界面<code>Linked To</code>区域点击右下角的<code>Add to JCenter</code>，什么也不用填，直接点击<code>Send</code>。</p>
<p>现在我们所能做的就是等待bintray团队审核我们的请求，大概4-5个小时。一旦同步的请求审核通过，你会收到一封确认此更改的邮件。现在我们去网页上确认，你会在 Linked To 部分看到已链接到JCenter仓库。</p>
<h2 id="5-用法"><a href="#5-用法" class="headerlink" title="5. 用法"></a>5. 用法</h2><p>从此之后，任何开发者都可以使用JCenter() repository 外加一行gradle脚本来使用我们的library了</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">compile <span class="string">'com.sherlockshi.widget:aspectratioimageview:1.0.1'</span></span><br></pre></td></tr></table></figure>
<p>想检查一下自己的library在JCenter上是否存在？你可以直接访问<a href="http://jcenter.bintray.com" target="_blank" rel="external">http://jcenter.bintray.com</a> ，然后进入和你library的group id 以及artifact id匹配的目录。在本例中就是com -&gt; sherlockshi -&gt; widget -&gt; aspectratioimageview -&gt; 1.0.1。</p>
<p>请注意链接到JCenter是一个只需做一次的操作。如果你对你的package做了任何修改，比如上传了一个新版本的binary，删除了旧版本的binary等等，这些改变也会影响到JCenter。不过毕竟你自己的仓库和JCenter在不同的地方，所以需要等待2－3分钟让JCenter同步这些修改。</p>
<p>同时注意，如果你决定删除整个package，放在JCenter仓库上的library不会被删除。它们会像僵尸一样的存在，没有人再能删除它了。因此我建议，如果你想删除整个package，请在移除package之前先在网页上删除每一个版本。</p>
<p>恭喜！虽然需要许多步骤，但是每一步都很简单。而且大部分操作都是一劳永逸的。</p>
<p>期待能在上面看到你的library大作！</p>
<h1 id="六、踩坑经历"><a href="#六、踩坑经历" class="headerlink" title="六、踩坑经历"></a>六、踩坑经历</h1><h2 id="1-编译上传时，提示jar包未找到"><a href="#1-编译上传时，提示jar包未找到" class="headerlink" title="1. 编译上传时，提示jar包未找到"></a>1. 编译上传时，提示jar包未找到</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">:aspectratioimageview:bintrayUpload: file /Users/sherlock/work/workspace/AndroidStudio/AspectRatioImageView/aspectratioimageview/build/libs/aspectratioimageview-1.0.1-javadoc.jar could not be found.</span><br><span class="line">:aspectratioimageview:bintrayUpload: file /Users/sherlock/work/workspace/AndroidStudio/AspectRatioImageView/aspectratioimageview/build/libs/aspectratioimageview-1.0.1-sources.jar could not be found.</span><br></pre></td></tr></table></figure>
<p>解决方法：<br>先执行<code>gradlew install</code>，再执行<code>gradlew bintrayUpload</code></p>
<h2 id="2-Javadoc-generation-failed"><a href="#2-Javadoc-generation-failed" class="headerlink" title="2. Javadoc generation failed"></a>2. Javadoc generation failed</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line">:sherlockspinner:javadoc</span><br><span class="line">/path/.../xxx.java:7: 错误: 程序包android.support.annotation不存在</span><br><span class="line">import android.support.annotation.ColorInt;</span><br><span class="line">                                 ^</span><br><span class="line">/path/.../xxx.java:8: 错误: 程序包android.support.annotation不存在</span><br><span class="line">import android.support.annotation.ColorRes;</span><br><span class="line">                                 ^</span><br><span class="line">/path/.../xxx.java:9: 错误: 程序包android.support.annotation不存在</span><br><span class="line">import android.support.annotation.DrawableRes;</span><br><span class="line">                                 ^</span><br><span class="line">/path/.../xxx.java:10: 错误: 程序包android.support.v4.content不存在</span><br><span class="line">import android.support.v4.content.ContextCompat;</span><br><span class="line">                                 ^</span><br><span class="line">/path/.../xxx.java:11: 错误: 程序包android.support.v4.view不存在</span><br><span class="line">import android.support.v4.view.ViewCompat;</span><br><span class="line">                              ^</span><br><span class="line">/path/.../xxx.java:12: 错误: 程序包android.support.v7.widget不存在</span><br><span class="line">import android.support.v7.widget.AppCompatEditText;</span><br><span class="line">                                ^</span><br><span class="line">/path/.../xxx.java:13: 错误: 程序包android.support.v7.widget不存在</span><br><span class="line">import android.support.v7.widget.ListPopupWindow;</span><br><span class="line">                                ^</span><br><span class="line">/path/.../xxx.java:27: 错误: 找不到符号</span><br><span class="line">public class SherlockSpinner extends AppCompatEditText &#123;</span><br><span class="line">                                     ^</span><br><span class="line">  符号: 类 AppCompatEditText</span><br><span class="line">/path/.../xxx.java:35: 错误: 找不到符号</span><br><span class="line">    private ListPopupWindow mListPopupWindow;</span><br><span class="line">            ^</span><br><span class="line">  符号:   类 ListPopupWindow</span><br><span class="line">  位置: 类 SherlockSpinner</span><br><span class="line">/path/.../xxx.java:140: 错误: 找不到符号</span><br><span class="line">    public void <span class="built_in">set</span>LineColorResource(@ColorRes int resId) &#123;</span><br><span class="line">                                      ^</span><br><span class="line">  符号:   类 ColorRes</span><br><span class="line">  位置: 类 SherlockSpinner</span><br><span class="line">/path/.../xxx.java:149: 错误: 找不到符号</span><br><span class="line">    public void <span class="built_in">set</span>LineColor(@ColorInt int color) &#123;</span><br><span class="line">                              ^</span><br><span class="line">  符号:   类 ColorInt</span><br><span class="line">  位置: 类 SherlockSpinner</span><br><span class="line">/path/.../xxx.java:208: 错误: 找不到符号</span><br><span class="line">    public void <span class="built_in">set</span>DropdownIcon(@DrawableRes int resId) &#123;</span><br><span class="line">                                 ^</span><br><span class="line">  符号:   类 DrawableRes</span><br><span class="line">  位置: 类 SherlockSpinner</span><br><span class="line">/path/.../xxx.java:138: 警告: @param 没有说明</span><br><span class="line">     * @param resId</span><br><span class="line">       ^</span><br><span class="line">/path/.../xxx.java:147: 警告: @param 没有说明</span><br><span class="line">     * @param color</span><br><span class="line">       ^</span><br><span class="line">/path/.../xxx.java:170: 错误: 找不到引用</span><br><span class="line">     * @see <span class="comment">#setClickable(boolean)</span></span><br><span class="line">            ^</span><br><span class="line">/path/.../xxx.java:172: 警告 - 标记@see: 在com.sherlockshi.widget.SherlockSpinner中找不到<span class="built_in">set</span>Clickable(boolean)</span><br><span class="line">/path/.../xxx.java:206: 警告: @param 没有说明</span><br><span class="line">     * @param resId</span><br><span class="line">       ^</span><br><span class="line">javadoc: 警告 - 找不到类ColorRes。</span><br><span class="line">javadoc: 警告 - 找不到类ColorInt。</span><br><span class="line">javadoc: 警告 - 找不到类DrawableRes。</span><br><span class="line">1 个错误</span><br><span class="line">19 个警告</span><br><span class="line">:sherlockspinner:javadoc FAILED</span><br><span class="line"></span><br><span class="line">FAILURE: Build failed with an exception.</span><br><span class="line"></span><br><span class="line">* What went wrong:</span><br><span class="line">Execution failed <span class="keyword">for</span> task <span class="string">':sherlockspinner:javadoc'</span>.</span><br><span class="line">&gt; Javadoc generation failed. Generated Javadoc options file (useful <span class="keyword">for</span> troubleshooting): <span class="string">'/Users/sherlock/work/workspace/AndroidStudio/SherlockSpinner/sherlockspinner/build/tmp/javadoc/javadoc.options'</span></span><br></pre></td></tr></table></figure>
<p>解决方法：</p>
<ul>
<li>错误: 编码GBK的不可映射字符 ——注释不要用中文，或者修改项目的字符编码</li>
<li>错误: 找不到符号——删除javadoc里所有的html标签</li>
</ul>
<p>删除<code>@see #setClickable(boolean)</code>这一行代码注释。</p>
<h1 id="七、参考"><a href="#七、参考" class="headerlink" title="七、参考"></a>七、参考</h1><p><a href="http://www.devtf.cn/?p=760" target="_blank" rel="external">如何使用Android Studio把自己的Android library分发到JCenter和Maven Central</a></p>
<p><a href="https://github.com/xiaopansky/android-library-publish-to-jcenter" target="_blank" rel="external">5分钟发布Android Library项目到JCenter</a></p>
<p><a href="http://www.gcssloop.com/course/PublishLibraryByJitPack" target="_blank" rel="external">使用JitPack发布Android开源库</a></p>

	
	
	
	
</div>
				
				

                <!-- Post Comments -->
                
    <!-- 使用多说评论 -->
    <link rel="stylesheet" href="/css/duoshuo.min.css">
<style>
    #ds-thread #ds-reset .ds-post-button{
        background-color: #0097A7 !important;
    }
    #ds-wrapper #ds-reset .ds-icons-32{
        background-color: #0097A7 !important;
    }
    #ds-reset .ds-highlight {
        color: #0097A7 !important;
    }
</style>
<div id="comments">
    <!-- 多说评论框 start -->
        <div class="ds-thread" 
            data-thread-key="2016/09/29/15_Android/1555_Maven/使用Android Studio把自己的Android library分发到jCenter/" 
            data-url="http://sherlockshi.github.io/2016/09/29/15_Android/1555_Maven/使用Android Studio把自己的Android library分发到jCenter/"
            data-title="使用Android Studio把自己的Android library分发到JCenter"></div>
    <!-- 多说评论框 end -->
</div>



            </div>

            <!-- Post Prev & Next Nav -->
            <nav class="material-nav mdl-color-text--grey-50 mdl-cell mdl-cell--12-col">
    
    <!-- Prev Nav -->
    
        <a href="/2016/10/02/30_博客/3005_Hexo/Hexo常用命令/" id="post_nav-newer" class="prev-content">
            <button class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon mdl-color--white mdl-color-text--grey-900" role="presentation">
                <i class="material-icons">arrow_back</i>
            </button>
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
            新篇
        </a>
    

    <!-- Section Spacer -->
    <div class="section-spacer"></div>

    <!-- Next Nav -->
    
        <a href="/2016/08/18/40_微信公众平台/使用natapp进行微信本地开发调试/" id="post_nav-older" class="next-content">
            旧篇
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
            <button class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon mdl-color--white mdl-color-text--grey-900" role="presentation">
                <i class="material-icons">arrow_forward</i>
            </button>
        </a>
    
</nav>
        </div>
    </div>

				
				
					<!-- Overlay For Active Sidebar -->
<div class="sidebar-overlay "></div>

<!-- Material sidebar -->
<aside id="sidebar" class="sidebar sidebar-colored  sidebar-fixed-left" role="navigation">
	<div id="sidebar-main">
	    <!-- Sidebar Header -->
		<div class="sidebar-header header-cover" style="background-image: url(/img/sidebar_header.png);">
    <!-- Top bar -->
    <div class="top-bar"></div>

    <!-- Sidebar toggle button -->
    <button type="button" class="sidebar-toggle mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon" style="display: initial;" data-upgraded=",MaterialButton,MaterialRipple">
    <i class="material-icons">clear_all</i>
    <span class="mdl-button__ripple-container"><span class="mdl-ripple"></span></span></button>

    <!-- Sidebar Avatar -->
    <div class="sidebar-image">
        <img src="/img/avatar.png" alt="SherlockShi's avatar">
    </div>

    <!-- Sidebar Email -->
    <a data-toggle="dropdown" class="sidebar-brand" href="#settings-dropdown">
        sherlock_shi@163.com
        <b class="caret"></b>
    </a>
</div>

		<!-- Sidebar Navigation  -->
		<ul class="nav sidebar-nav">
    <!-- User dropdown  -->
    <li class="dropdown">
        <ul id="settings-dropdown" class="dropdown-menu">
			
                <li>
                    <a href="mailto:sherlock_shi@163.com" target="_blank" title="Email Me">
						<i class="material-icons sidebar-material-icons sidebar-indent-left1pc-element">email</i>
                        Email Me
                    </a>
                </li>
            
        </ul>
    </li>

    <!-- Homepage -->
    <li id="sidebar-first-li">
        <a href="/" target="_self">
            <i class="material-icons sidebar-material-icons">home</i>
             主页
        </a>
    </li>

    <!-- I'm Feeling Lucky -->
<!--
    <li class="dropdown">
        <a href="" target="_self">
            <i class="material-icons sidebar-material-icons">explore</i>
             sidebar.imlucky
        </a>
    </li>
-->

	
    <!-- Archives  -->
    <li class="dropdown">
        <a href="#" class="ripple-effect dropdown-toggle" data-toggle="dropdown">
            <i class="material-icons sidebar-material-icons">inbox</i>
             归档
            <b class="caret"></b>
        </a>
        <ul class="dropdown-menu">
            <li>
            <a class="sidebar_archives-link" href="/archives/2016/12/">十二月 2016<span class="sidebar_archives-count">4</span></a></li><li><a class="sidebar_archives-link" href="/archives/2016/11/">十一月 2016<span class="sidebar_archives-count">4</span></a></li><li><a class="sidebar_archives-link" href="/archives/2016/10/">十月 2016<span class="sidebar_archives-count">96</span></a></li><li><a class="sidebar_archives-link" href="/archives/2016/09/">九月 2016<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2016/08/">八月 2016<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2016/07/">七月 2016<span class="sidebar_archives-count">8</span></a></li><li><a class="sidebar_archives-link" href="/archives/2016/06/">六月 2016<span class="sidebar_archives-count">3</span></a></li><li><a class="sidebar_archives-link" href="/archives/2016/04/">四月 2016<span class="sidebar_archives-count">3</span></a>
        </ul>
    </li>

    <!-- Divider -->
    <li class="divider"></li>


    <!-- Pages  -->
	
		<li>
			<a href="/tags/" title="标签">
				标签
			</a>
		</li>
	
		<li>
			<a href="/links/" title="友情链接">
				友情链接
			</a>
		</li>
	

    <!-- Article Numebr  -->
    <li>
        <a href="/archives">
             文章总数
             <span class="sidebar-badge">120</span>
        </a>
    </li>
</ul>

		<!-- Sidebar Divider -->
		<div class="sidebar-divider"></div>

		<!-- Sidebar Footer -->
		<!-- 
I'm glad you use this theme, the development is no so easy, I hope you can keep the copyright, I will thank you so much.
If you still want to delete the copyrights, could you still retain the first one? Which namely "Theme Material"
It will not impact the appearance and can give developers a lot of support :)

很高兴您使用并喜欢该主题，开发不易 十分谢谢与希望您可以保留一下版权声明。
如果您仍然想删除的话 能否只保留第一项呢？即 "Theme Material"
它不会影响美观并可以给开发者很大的支持。 :) 
-->

<!-- Theme Material -->
<a href="https://github.com/viosey/hexo-theme-material"  class="sidebar-footer-text-a" target="_blank">
	<div class="sidebar-text mdl-button mdl-js-button mdl-js-ripple-effect sidebar-footer-text-div" data-upgraded=",MaterialButton,MaterialRipple">
		主题 - Material
		<span class="sidebar-badge badge-circle">i</span>
	</div>
</a>

<!-- Help & Support -->
<!--
<a href="mailto:hiviosey@gmail.com" class="sidebar-footer-text-a">
    <div class="sidebar-text mdl-button mdl-js-button mdl-js-ripple-effect sidebar-footer-text-div" data-upgraded=",MaterialButton,MaterialRipple">
		sidebar.help
		<span class="mdl-button__ripple-container">
			<span class="mdl-ripple"></span>
		</span>
	</div>
</a>
-->

<!-- Feedback -->
<!--
<a href="https://github.com/viosey/hexo-theme-material/issues" target="_blank" class="sidebar-footer-text-a">
    <div class="sidebar-text mdl-button mdl-js-button mdl-js-ripple-effect sidebar-footer-text-div" data-upgraded=",MaterialButton,MaterialRipple">
         sidebar.feedback
                    <span class="mdl-button__ripple-container"><span class="mdl-ripple"></span></span></div>
</a>
-->

<!-- Abount Theme -->
<!--
<a href="https://blog.viosey.com/index.php/Material.html" target="_blank" class="sidebar-footer-text-a">
    <div class="sidebar-text mdl-button mdl-js-button mdl-js-ripple-effect sidebar-footer-text-div" data-upgraded=",MaterialButton,MaterialRipple">
         sidebar.about_theme
        <span class="mdl-button__ripple-container"><span class="mdl-ripple"></span></span></div>
</a>-->

	</div>
    
    <!-- Sidebar Sponsor -->
    


</aside>

				
				
				
					<!-- Footer Top Button -->
					<div class="toTop-wrap">
    <a href="#top" class="toTop">
        <i class="material-icons footer_top-i">expand_less</i>
    </a>
</div>
				
				
				<!--Footer-->
<footer class="mdl-mini-footer" id="bottom">

    
    <!-- Paradox Footer Left Section -->
    <div class="mdl-mini-footer--left-section sns-list">
    <!-- Twitter -->
    
    
    
    <!-- Facebook -->
    
    
    
    <!-- Google + -->
    
    
    
    <!-- Weibo -->
    
    <a href="http://weibo.com/2283093752" target="view_window"><button class="mdl-mini-footer--social-btn social-btn" style="background-image: url(/img/footer/footer_ico-weibo.png);">
        <span class="visuallyhidden">Weibo</span>
    </button></a>
    
    
    <!-- Instagram -->
    
    
    
    <!-- Tumblr -->
    
    
    
    <!-- Github -->
    
    <a href="https://github.com/sherlockshi" target="view_window"><button class="mdl-mini-footer--social-btn social-btn" style="background-image: url(/img/footer/footer_ico-github.png);">
        <span class="visuallyhidden">Github</span>
    </button></a>
    
</div>


    <!--Copyright-->
    <div id="copyright">Copyright&nbsp;©&nbsp;
        <script type="text/javascript">var fd = new Date();
            document.write(fd.getFullYear());</script>
        &nbsp;SherlockShi's Home

        <script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>
        <div>
            本站总访问量 <span id="busuanzi_value_site_pv"></span> 次&nbsp&nbsp&nbsp
            你是第 <span id="busuanzi_value_site_uv"></span> 个来到的小伙伴
        </div>
    </div>

    <div>

    </div>

    <!-- Paradox Footer Right Section -->

    <!--
    I'm glad you use this theme, the development is no so easy, I hope you can keep the copyright.
    It will not impact the appearance and can give developers a lot of support :)

    很高兴您使用该主题，开发不易，希望您可以保留一下版权声明。
    它不会影响美观并可以给开发者很大的支持。 :)
    -->

    <div class="mdl-mini-footer--right-section">
        <div>
            <div class="footer-develop-div">Powered by <a href="https://hexo.io" target="_blank"
                                                          class="footer-develop-a">Hexo</a></div>
            <div class="footer-develop-div">Theme - <a href="https://github.com/viosey/hexo-theme-material"
                                                       target="_blank" class="footer-develop-a">Material</a></div>
        </div>
    </div>
    

</footer>
                
				<!-- Import File -->
<script src="/js/highlight.min.js"></script>
<script src="/js/js.min.js"></script>
<script src="/js/nprogress.js"></script>

<script type="text/javascript">
    NProgress.configure({
        showSpinner: true
    });
    NProgress.start();
    
    $('#nprogress .bar').css({
        'background': '#FF4081'
    });
    $('#nprogress .peg').css({
        'box-shadow': '0 0 10px #FF4081, 0 0 15px #FF4081'
    });
    $('#nprogress .spinner-icon').css({
        'border-top-color': '#FF4081',
        'border-left-color': '#FF4081'
    });
    
    setTimeout(function() {
        NProgress.done();
        $('.fade').removeClass('out');
    }, 800);
</script>




    <!-- Leancloud -->
	<script src="https://cdn1.lncld.net/static/js/av-core-mini-0.6.1.js"></script>
	<script>
		AV.initialize("H2W8h4AbtEwoE7j8i0AA9ABU-gzGzoHsz", "44qGllcHkSbi5usA2bihFiN1");
	</script>
    <script>
	function showTime(Counter) {
		var query = new AV.Query(Counter);
		$(".leancloud-views_num").each(function() {
			var url = $(this).attr("id").trim();
			query.equalTo("url", url);
			query.find({
				success: function(results) {
					if (results.length == 0) {
						var content = '0 ' + $(document.getElementById(url)).text();
						$(document.getElementById(url)).text(content);
						return;
					}
					for (var i = 0; i < results.length; i++) {
						var object = results[i];
						var content = object.get('time') + ' ' + $(document.getElementById(url)).text();
						$(document.getElementById(url)).text(content);
					}
				},
				error: function(object, error) {
					console.log("Error: " + error.code + " " + error.message);
				}
			});

		});
	}

	function addCount(Counter) {
		var Counter = AV.Object.extend("Counter");
		url = $(".leancloud-views_num").attr('id').trim();
		title = $(".leancloud-views_num").attr('data-flag-title').trim();
		var query = new AV.Query(Counter);
		query.equalTo("url", url);
		query.find({
			success: function(results) {
				if (results.length > 0) {
					var counter = results[0];
					counter.fetchWhenSave(true);
					counter.increment("time");
					counter.save(null, {
						success: function(counter) {
							var content =  counter.get('time') + ' ' + $(document.getElementById(url)).text();
							$(document.getElementById(url)).text(content);
						},
						error: function(counter, error) {
							console.log('Failed to save Visitor num, with error message: ' + error.message);
						}
					});
				} else {
					var newcounter = new Counter();
					newcounter.set("title", title);
					newcounter.set("url", url);
					newcounter.set("time", 1);
					newcounter.save(null, {
						success: function(newcounter) {
							console.log("newcounter.get('time')="+newcounter.get('time'));
							var content = newcounter.get('time') + ' ' + $(document.getElementById(url)).text();
							$(document.getElementById(url)).text(content);
						},
						error: function(newcounter, error) {
							console.log('Failed to create');
						}
					});
				}
			},
			error: function(error) {
				console.log('Error:' + error.code + " " + error.message);
			}
		});
	}
	$(function() {
		var Counter = AV.Object.extend("Counter");
		if ($('.leancloud-views_num').length == 1) {
			addCount(Counter);
		} else if ($('.post-title-link').length > 1) {
			showTime(Counter);
		}
	}); 
</script>



    <!-- Busuanzi -->
    <script src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>



    <!-- 多说公共 js 代码 start -->
    <script type="text/javascript">
    var duoshuoQuery = {short_name:"sherlockshi"};
        (function() {
            var ds = document.createElement('script');
            ds.type = 'text/javascript';ds.async = true;
            ds.src = 'https://static.duoshuo.com/embed.js';
            ds.charset = 'UTF-8';
            (document.getElementsByTagName('head')[0] 
             || document.getElementsByTagName('body')[0]).appendChild(ds);
        })();
    </script>
    <!-- 多说公共 js 代码 end -->




<!-- Swiftye -->


<!-- Local Search-->

	<script>
	var searchFunc = function(path, search_id, content_id) {
    'use strict';
    $.ajax({
        url: path,
        dataType: "xml",
        success: function( xmlResponse ) {
            // get the contents from search data
            var datas = $( "entry", xmlResponse ).map(function() {
                return {
                    title: $( "title", this ).text(),
                    content: $("content",this).text(),
                    url: $( "url" , this).text()
                };
            }).get();
            var $input = document.getElementById(search_id);
            var $resultContent = document.getElementById(content_id);
            $input.addEventListener('input', function(){
                var str='<ul class=\"search-result-list\">';                
                var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
                $resultContent.innerHTML = "";
                if (this.value.trim().length <= 0) {
                    return;
                }
                // perform local searching
                datas.forEach(function(data) {
                    var isMatch = true;
                    var content_index = [];
                    var data_title = data.title.trim().toLowerCase();
                    var data_content = data.content.trim().replace(/<[^>]+>/g,"").toLowerCase();
                    var data_url = data.url;
                    var index_title = -1;
                    var index_content = -1;
                    var first_occur = -1;
                    // only match artiles with not empty titles and contents
                    if(data_title != '' && data_content != '') {
                        keywords.forEach(function(keyword, i) {
                            index_title = data_title.indexOf(keyword);
                            index_content = data_content.indexOf(keyword);
                            if( index_title < 0 && index_content < 0 ){
                                isMatch = false;
                            } else {
                                if (index_content < 0) {
                                    index_content = 0;
                                }
                                if (i == 0) {
                                    first_occur = index_content;
                                }
                            }
                        });
                    }
                    // show search results
                    if (isMatch) {
                        str += "<li><a href='"+ data_url +"' class='search-result-title' target='_blank'>"+ data_title;
                        var content = data.content.trim().replace(/<[^>]+>/g,"");
                        if (first_occur >= 0) {
                            // cut out characters
                            var start = first_occur - 6;
                            var end = first_occur + 6;
                            if(start < 0){
                                start = 0;
                            }
                            if(start == 0){
                                end = 10;
                            }
                            if(end > content.length){
                                end = content.length;
                            }
                            var match_content = content.substr(start, end); 
                            // highlight all keywords
                            keywords.forEach(function(keyword){
                                var regS = new RegExp(keyword, "gi");
                                match_content = match_content.replace(regS, "<em class=\"search-keyword\">"+keyword+"</em>");
                            })
                            str += "<p class=\"search-result\">" + match_content +"...</p>" +"</a>";
                        }
                    }
                })
                $resultContent.innerHTML = str;
            })
        }
    })
}
</script>

	<script>
        var inputArea = document.querySelector("#search");
        var getSearchFile = function(){
            var path = "search.xml";
            searchFunc(path, 'search', 'local-search-result');
        }

        inputArea.onfocus = function(){ getSearchFile() }
	</script>


<!-- Window Load-->
<script>
    $(window).load(function() {
        // Post_Toc parent position fixed
        $(".post-toc-wrap").parent(".mdl-menu__container").css("position", "fixed");
    });
</script>

<!-- MathJax Load-->

            </main>
        </div>
		
    </body>
		
	
</html>
